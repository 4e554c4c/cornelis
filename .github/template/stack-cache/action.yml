name: Cache Stack dirs
description: foo

inputs:
  global-stack-dir:
    description: Path to global Stack cache
    required: false
    default: ~/.stack
  stack-work-dir:
    description: Path to project local Stack cache
    required: false
    default: .stack-work

runs:
  using: "composite"

  steps:
    - name: Create unique key
      shell: bash
      run: |
        echo "unique_key=$(date '+%s')" >> $GITHUB_ENV

    - name: Cache ${{ inputs.global-stack-dir }}
      uses: actions/cache@v3
      with:
        path: ${{ inputs.global-stack-dir }}
        key: ${{ runner.os }}-stack-global-${{ hashFiles('stack.yaml') }}-${{ hashFiles('package.yaml') }}-${{ env.unique_key }}
        restore-keys: |
          ${{ runner.os }}-stack-global-${{ hashFiles('stack.yaml') }}-${{ hashFiles('package.yaml') }}-
          ${{ runner.os }}-stack-global-${{ hashFiles('stack.yaml') }}-
          ${{ runner.os }}-stack-global-

    - name: Cache .stack-work
      uses: actions/cache@v3
      with:
        path: ${{ inputs.stack-work-dir }}
        key: ${{ runner.os }}-stack-work-${{ hashFiles('stack.yaml') }}-${{ hashFiles('package.yaml') }}-${{ hashFiles('**/*.hs') }}-${{ env.unique_key }}
        restore-keys: |
          ${{ runner.os }}-stack-work-${{ hashFiles('stack.yaml') }}-${{ hashFiles('package.yaml') }}-${{ hashFiles('**/*.hs') }}-
          ${{ runner.os }}-stack-work-${{ hashFiles('stack.yaml') }}-${{ hashFiles('package.yaml') }}-
          ${{ runner.os }}-stack-work-${{ hashFiles('stack.yaml') }}-
          ${{ runner.os }}-stack-work-
